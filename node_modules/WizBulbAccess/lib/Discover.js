'use strict';

const message = '{"method":"registration","params":{"phoneMac":"AAAAAAAAAAAA","register":false,"phoneIp":"1.2.3.4","id":"1"}}';
var temp;

class Discover {

	constructor() {
		this._scanned = false;
		this._clients = [];
	}

	get_clients() {
		return this._clients;
	}

	get_scanned() {
		return this._scanned;
	}

	scan(timeout = 5000, callback = undefined) {
		let promise = new Promise((resolve, reject) => {
			let client = dgram.createSocket('udp4');
			client.setBroadcast(true);

			client.on('message', function (msg, info) {
				JSonObj = JSON.stringify(msg);
				if (JSonObj.hasOwnProperty('mac')) {
					temp = JSonObj.mac;
				}
				_clients.push(`${temp};${info.address};`);
				_scanned = true;
				client.close();
			});

			client.send(message, 0, message.length, PORT, ipAddr, function (err, bytes) {
				if (error) {
					client.close();
				}
			});

			setTimeout(() => {
				client.close();
				this._scanned = true;
				resolve(this._clients);
			}, timeout);
		}
	}

}

module.exports = Discover;

